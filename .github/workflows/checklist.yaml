name: PR Checklist Bot

on:
  pull_request:
    branches: 
      - dev

jobs:
  checklist:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - name: Post/Update Checklist
        uses: actions/github-script@v6
        id: checklist
        with:
          script: |
            const { owner, repo } = context.repo;
            const prNumber = context.issue.number;
            
            // Look for existing checklist comment.
            const comments = await github.rest.issues.listComments({
              owner,
              repo,
              issue_number: prNumber
            });
            
            const botComment = comments.data.find(comment => 
              comment.body.includes('## PR Checklist') && 
              comment.user.login === 'github-actions[bot]'
            );
            
            const checklist = `
              ## PR Checklist âœ…
              Have you checked the following?
              - [ ] Does not contain the names of any sensitive CPG projects
              - [ ] Version number is bumped appropriately if API is changed
              - [ ] Tests cover any newly added code

              *Check all boxes before merging.*`;

            if (botComment) {
              // Update existing comment.
              await github.rest.issues.updateComment({
                owner,
                repo,
                comment_id: botComment.id,
                body: checklist
              });
            } else {
              // Create new comment.
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: prNumber,
                body: checklist
              });
            }